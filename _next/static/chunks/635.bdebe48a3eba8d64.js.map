{"version":3,"file":"static/chunks/635.bdebe48a3eba8d64.js","mappings":"kyCASO,IAAMA,EAAN,SAAQ,I,mQAAFA,I,mIACDC,QAAUC,SAASC,cAAc,O,EAElCC,SAAqB,IAAIC,EAAAA,SAAS,CACrCC,WAAY,M,EAGTC,YAAc,IAAIC,EAAAA,Y,EAERC,SAAW,IAAIC,EAAAA,S,EAgDvBT,QAAQU,MAAMC,MAAQ,O,EACtBX,QAAQU,MAAME,OAAS,O,EACvBZ,QAAQU,MAAMG,SAAW,S,EAEzBV,SAASW,QAAQC,WAAa,gF,EAC9BZ,SAASW,QAAQE,cAAgB,E,EACjCb,SAASW,QAAQG,YAAc,M,EAC/Bd,SAASe,UAAU,EAAKZ,a,EACxBH,SAASe,UAAU,EAAKV,U,kBApDtBW,IAAAA,S,IAAX,WAAsB,OAAOC,KAAKC,S,IAClC,SAAkBC,G,IAIV,EAKJ,GARIF,KAAKC,UAELD,KAAKG,UACsB,QAA3B,EAAAH,KAAKI,8BAAL,SAA6BC,SAGjCL,KAAKC,QAAUC,EAEXA,EAAO,C,WACPF,KAAKjB,SAASuB,QACdN,KAAKjB,SAASwB,QAEdP,KAAKI,uBAAyB,IAAII,EAAAA,gBAElCN,EAAMO,OAAOC,OAAO,IAAIC,EAAAA,eAA2B,CAC/CC,MAAO,SAACC,G,EACC9B,SAAS6B,MAAMC,MAExB,CACAC,OAAQd,KAAKI,uBAAuBU,SAExCZ,EAAMa,OAAOL,OAAO,IAAIC,EAAAA,eAA2B,CAC/CC,MAAO,SAACC,G,EACC9B,SAAS6B,MAAMC,MAExB,CACAC,OAAQd,KAAKI,uBAAuBU,SAGxC,IAAME,EAAUd,EAAMe,MAAMC,YAC5BlB,KAAKmB,cAAcnB,KAAKjB,SAASqC,QAAOC,SAAAA,GACpC,IAAMC,GAASC,EAAAA,EAAAA,YAAWF,GAC1BL,EAAQJ,MAAMU,OAGlBtB,KAAKwB,S,CAkBNC,IAAAA,e,MAAP,SAAoBC,GAChBA,EAAUC,YAAY3B,KAAKpB,SACtBoB,KAAKjB,SAASH,UACVoB,KAAKpB,QAAQgD,YAClB5B,KAAKjB,SAAS8C,KAAK7B,KAAKpB,SACxBoB,KAAKjB,SAASe,UAAU,IAAIgC,EAAAA,YAE5B9B,KAAKjB,SAASW,QAAQqC,aAAc,EACpC/B,KAAKwB,S,CAINA,IAAAA,M,MAAP,W,IAII,EAHAxB,KAAKZ,SAASoC,MAEd,IAAuB,EAAAxB,KAAKjB,SAApBiD,EAAe,EAAfA,KAAMC,EAAS,EAATA,KACF,QAAZ,EAAAjC,KAAKC,eAAL,SAAciC,OAAOF,EAAMC,Q,6BApF5B,CAA0BE,EAAAA","sources":["webpack://_N_E/./components/terminal.tsx"],"sourcesContent":["// cspell: ignore scrollback\n\nimport { AbortController, AdbSubprocessProtocol, encodeUtf8, WritableStream } from \"@yume-chan/adb\";\nimport { AutoDisposable } from \"@yume-chan/event\";\nimport { Terminal } from 'xterm';\nimport { FitAddon } from 'xterm-addon-fit';\nimport { SearchAddon } from 'xterm-addon-search';\nimport { WebglAddon } from 'xterm-addon-webgl';\n\nexport class AdbTerminal extends AutoDisposable {\n    private element = document.createElement('div');\n\n    public terminal: Terminal = new Terminal({\n        scrollback: 9000,\n    });\n\n    public searchAddon = new SearchAddon();\n\n    private readonly fitAddon = new FitAddon();\n\n    private _socket: AdbSubprocessProtocol | undefined;\n    private _socketAbortController: AbortController | undefined;\n    public get socket() { return this._socket; }\n    public set socket(value) {\n        if (this._socket) {\n            // Remove event listeners\n            this.dispose();\n            this._socketAbortController?.abort();\n        }\n\n        this._socket = value;\n\n        if (value) {\n            this.terminal.clear();\n            this.terminal.reset();\n\n            this._socketAbortController = new AbortController();\n\n            value.stdout.pipeTo(new WritableStream<Uint8Array>({\n                write: (chunk) => {\n                    this.terminal.write(chunk);\n                },\n            }), {\n                signal: this._socketAbortController.signal,\n            });\n            value.stderr.pipeTo(new WritableStream<Uint8Array>({\n                write: (chunk) => {\n                    this.terminal.write(chunk);\n                },\n            }), {\n                signal: this._socketAbortController.signal,\n            });\n\n            const _writer = value.stdin.getWriter();\n            this.addDisposable(this.terminal.onData(data => {\n                const buffer = encodeUtf8(data);\n                _writer.write(buffer);\n            }));\n\n            this.fit();\n        }\n    }\n\n    public constructor() {\n        super();\n\n        this.element.style.width = '100%';\n        this.element.style.height = '100%';\n        this.element.style.overflow = 'hidden';\n\n        this.terminal.options.fontFamily = '\"Cascadia Code\", Consolas, monospace, \"Source Han Sans SC\", \"Microsoft YaHei\"';\n        this.terminal.options.letterSpacing = 1;\n        this.terminal.options.cursorStyle = 'bar';\n        this.terminal.loadAddon(this.searchAddon);\n        this.terminal.loadAddon(this.fitAddon);\n    }\n\n    public setContainer(container: HTMLDivElement) {\n        container.appendChild(this.element);\n        if (!this.terminal.element) {\n            void this.element.offsetWidth;\n            this.terminal.open(this.element);\n            this.terminal.loadAddon(new WebglAddon());\n            // WebGL renderer ignores `cursorBlink` set before it initialized\n            this.terminal.options.cursorBlink = true;\n            this.fit();\n        }\n    }\n\n    public fit() {\n        this.fitAddon.fit();\n        // Resize remote terminal\n        const { rows, cols } = this.terminal;\n        this._socket?.resize(rows, cols);\n    }\n}\n"],"names":["AdbTerminal","element","document","createElement","terminal","Terminal","scrollback","searchAddon","SearchAddon","fitAddon","FitAddon","style","width","height","overflow","options","fontFamily","letterSpacing","cursorStyle","loadAddon","socket","this","_socket","value","dispose","_socketAbortController","abort","clear","reset","AbortController","stdout","pipeTo","WritableStream","write","chunk","signal","stderr","_writer","stdin","getWriter","addDisposable","onData","data","buffer","encodeUtf8","fit","setContainer","container","appendChild","offsetWidth","open","WebglAddon","cursorBlink","rows","cols","resize","AutoDisposable"],"sourceRoot":""}