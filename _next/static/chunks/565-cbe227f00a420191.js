"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{2127:function(e,t,n){n.a(e,(async function(e,r){try{n.r(t),n.d(t,{ProgressStream:function(){return H}});var i=n(578),a=n.n(i),o=n(5202),s=n(926),c=n(4593),u=n(1837),l=n(5148),p=n(8083),d=n(2070),f=n(7624),h=n(6004),m=n(2592),y=n(758),v=n(7082),b=n(9711),x=n(5135),g=n(4798),k=n(1411),w=n(4343),S=n(4215),z=n(1509),C=n(3461),j=n(7177),P=n(5780),T=n(7771),D=n(6282),I=n(7602),F=n(8731),L=n(3705),O=n(7303),E=n.n(O),R=n(6393),_=n(5880),U=n(4258),M=n(5909);function e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){var t;if("function"===typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}function X(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,i)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){X(a,r,i,o,s,"next",e)}function s(e){X(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}function ne(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$(e,t,n[t])}))}return e}function ie(t,n){return!n||"object"!==W(n)&&"function"!==typeof n?e(t):n}function ae(e,t){return ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ae(e,t)}var W=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function oe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function se(e){var t=oe();return function(){var n,r=ee(e);if(t){var i=ee(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ie(this,n)}}var A,H=function(e){te(n,e);var t=se(n);function n(e){Z(this,n);var r=0;return t.call(this,(function(t){r+=t.byteLength,e(r)}))}return n}(P.InspectStream),K=(0,I.default)().publicRuntimeConfig;function ce(e){return re({},e,{key:e.name})}(A=await n(2140)).mitm=K.basePath+"/StreamSaver/mitm.html";var N=(0,s.mergeStyleSets)({name:{cursor:"pointer","&:hover":{textDecoration:"underline"}}}),B=function(e,t){return e&&t?t(re({},e,{styles:(0,s.concatStyleSets)(e.styles,{root:{paddingTop:0}})})):null};function ue(e,t){var n=e.toLocaleLowerCase().localeCompare(t.toLocaleLowerCase());return 0!==n?n:e.localeCompare(t)}var J=function(){function e(){var t=this;Z(this,e),this.initial=!0,this.visible=!1,this.path="/",this.loading=!1,this.items=[],this.sortKey="name",this.sortDescending=!1,this.uploading=!1,this.uploadPath=void 0,this.uploadedSize=0,this.uploadTotalSize=0,this.debouncedUploadedSize=0,this.uploadSpeed=0,this.selectedItems=[],this.contextMenuTarget=void 0,this.pushPathQuery=function(e){L.default.push({query:re({},L.default.query,{path:e})})};var n=this;this.loadFiles=(0,M.FW)(function(){var e=V(a().mark((function e(t){var r,i,o,s,c,u,l,p,d,f,h,m,y,v,b,x,g,k;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.path,(0,T.z)((function(){return n.items=[]})),U.n.device){e.next=4;break}return e.abrupt("return");case 4:return(0,T.z)((function(){return n.loading=!0})),e.next=7,U.n.device.sync();case 7:i=e.sent,o=[],s=[],c=setInterval((function(){t.aborted||(0,T.z)((function(){return n.items=o.slice()}))}),1e3),e.prev=11,u=!1,l=!1,e.prev=13,d=Y(i.opendir(r));case 15:return e.next=17,d.next();case 17:if(!(u=!(f=e.sent).done)){e.next=28;break}if(h=f.value,m=h,!t.aborted){e.next=22;break}return e.abrupt("return");case 22:if("."!==m.name&&".."!==m.name){e.next=24;break}return e.abrupt("continue",25);case 24:m.type===P.LinuxFileType.Link?s.push(m):o.push(ce(m));case 25:u=!1,e.next=15;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(13),l=!0,p=e.t0;case 34:if(e.prev=34,e.prev=35,!u||null==d.return){e.next=39;break}return e.next=39,p.return();case 39:if(e.prev=39,!l){e.next=42;break}throw p;case 42:return e.finish(39);case 43:return e.finish(34);case 44:y=!0,v=!1,b=void 0,e.prev=45,x=s[Symbol.iterator]();case 47:if(y=(g=x.next()).done){e.next=59;break}if(k=g.value,!t.aborted){e.next=51;break}return e.abrupt("return");case 51:return e.next=53,i.isDirectory(E().resolve(r,k.name));case 53:if(e.sent){e.next=55;break}k.mode=P.LinuxFileType.File<<12|k.permission,k.size=0;case 55:o.push(ce(k));case 56:y=!0,e.next=47;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(45),v=!0,b=e.t1;case 65:e.prev=65,e.prev=66,y||null==x.return||x.return();case 68:if(e.prev=68,!v){e.next=71;break}throw b;case 71:return e.finish(68);case 72:return e.finish(65);case 73:if(!t.aborted){e.next=75;break}return e.abrupt("return");case 75:(0,T.z)((function(){return n.items=o}));case 76:return e.prev=76,t.aborted||(0,T.z)((function(){return n.loading=!1})),clearInterval(c),i.dispose(),e.finish(76);case 81:case"end":return e.stop()}}),e,null,[[11,,76,81],[13,30,34,44],[35,,39,43],[45,61,65,73],[66,,68,72]])})));return function(t){return e.apply(this,arguments)}}());var r=this;this.upload=function(){var e=V(a().mark((function e(t){var n,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.n.device.sync();case 2:return n=e.sent,e.prev=3,i=E().resolve(r.path,t.name),(0,T.z)((function(){r.uploading=!0,r.uploadPath=t.name,r.uploadedSize=0,r.uploadTotalSize=t.size,r.debouncedUploadedSize=0,r.uploadSpeed=0})),o=setInterval((0,T.aD)((function(){r.uploadSpeed=r.uploadedSize-r.debouncedUploadedSize,r.debouncedUploadedSize=r.uploadedSize})),1e3),e.prev=7,e.next=10,t.stream().pipeThrough(new P.ChunkStream(P.ADB_SYNC_MAX_PACKET_SIZE)).pipeThrough(new H((0,T.aD)((function(e){r.uploadedSize=e})))).pipeTo(n.write(i,P.LinuxFileType.File<<12|438,t.lastModified/1e3));case 10:(0,T.z)((function(){r.uploadSpeed=r.uploadedSize-r.debouncedUploadedSize,r.debouncedUploadedSize=r.uploadedSize}));case 11:return e.prev=11,clearInterval(o),e.finish(11);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),U.n.showErrorDialog(ne(e.t0,Error)?e.t0.message:"".concat(e.t0));case 19:return e.prev=19,n.dispose(),r.loadFiles(),(0,T.z)((function(){r.uploading=!1})),e.finish(19);case 24:case"end":return e.stop()}}),e,null,[[3,16,19,24],[7,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),(0,T.ky)(this,{initial:!1,items:T.LO.shallow,pushPathQuery:!1,changeDirectory:T.aD.bound,loadFiles:!1}),(0,T.EH)((function(){U.n.device?t.initial&&t.visible&&(t.initial=!1,t.loadFiles()):t.initial=!0}))}var t,n,r;return t=e,(n=[{key:"breadcrumbItems",get:function(){var e=this,t="",n=this.path.split("/").filter(Boolean).map((function(n){var r=e;return{key:t+="/"+n,text:n,onClick:function(e,t){t&&r.pushPathQuery(t.key)}}}));return n.unshift({key:"/",text:"Device",onClick:function(){return e.pushPathQuery("/")}}),n[n.length-1].isCurrentItem=!0,delete n[n.length-1].onClick,n}},{key:"menuItems",get:function(){var e=[];switch(this.selectedItems.length){case 0:var t=this;e.push({key:"upload",text:"Upload",iconProps:{iconName:M.PJ.CloudArrowUp,style:{height:20,fontSize:20,lineHeight:1.5}},disabled:!U.n.device,onClick:function(){var e=t;return V(a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,M.oT)({multiple:!0});case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=11;break}return i=n.item(r),t.next=8,e.upload(i);case 8:r++,t.next=4;break;case 11:case"end":return t.stop()}}),t)})))(),!1}});break;case 1:if(this.selectedItems[0].type===P.LinuxFileType.File){var n=this;e.push({key:"download",text:"Download",iconProps:{iconName:M.PJ.CloudArrowDown,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:function(){var e=n;return V(a().mark((function t(){var n,r,i,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,U.n.device.sync();case 2:return n=t.sent,t.prev=3,r=e.selectedItems[0],i=E().resolve(e.path,r.name),o=n.read(i),s=A.createWriteStream(r.name,{size:r.size}),t.next=10,o.pipeTo(s);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),U.n.showErrorDialog(ne(t.t0,Error)?t.t0.message:"".concat(t.t0));case 15:return t.prev=15,n.dispose(),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[3,12,15,18]])})))(),!1}})}default:var r=this;e.push({key:"delete",text:"Delete",iconProps:{iconName:M.PJ.Delete,style:{height:20,fontSize:20,lineHeight:1.5}},onClick:function(){var e=r;return V(a().mark((function t(){var n,r,i,o,s,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=!0,r=!1,i=void 0,t.prev=2,o=e.selectedItems[Symbol.iterator]();case 4:if(n=(s=o.next()).done){t.next=15;break}return c=s.value,t.next=8,U.n.device.rm(E().resolve(e.path,c.name));case 8:if(!(u=t.sent)){t.next=12;break}return U.n.showErrorDialog(u),t.abrupt("return");case 12:n=!0,t.next=4;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(2),r=!0,i=t.t0;case 21:t.prev=21,t.prev=22,n||null==o.return||o.return();case 24:if(t.prev=24,!r){t.next=27;break}throw i;case 27:return t.finish(24);case 28:return t.finish(21);case 29:t.next=34;break;case 31:t.prev=31,t.t1=t.catch(0),U.n.showErrorDialog(ne(t.t1,Error)?t.t1.message:"".concat(t.t1));case 34:return t.prev=34,e.loadFiles(),t.finish(34);case 37:case"end":return t.stop()}}),t,null,[[0,31,34,37],[2,17,21,29],[22,,24,28]])})))(),!1}})}return e}},{key:"sortedList",get:function(){var e=this,t=this.items.slice();return t.sort((function(t,n){var r,i=t.type===P.LinuxFileType.File?1:0,a=n.type===P.LinuxFileType.File?1:0;if(i!==a)r=i-a;else{var o=t[e.sortKey],s=n[e.sortKey];r=o===s?ue(t.name,n.name):"string"===typeof o?ue(o,s):o<s?-1:1}return e.sortDescending&&(r*=-1),r})),t}},{key:"columns",get:function(){var e=[{key:"type",name:"File Type",iconName:M.PJ.Document20,isIconOnly:!0,minWidth:20,maxWidth:20,isCollapsible:!0,onRender:function(e){var t;switch(e.type){case P.LinuxFileType.Link:t=(0,z.my)(void 0,S.I.linkedFolder);break;case P.LinuxFileType.Directory:t=(0,z.my)(void 0,S.I.folder);break;case P.LinuxFileType.File:t=(0,z.my)(E().extname(e.name),void 0);break;default:t=(0,z.my)("txt",void 0)}return(0,o.jsx)(c.J,{imageProps:{crossOrigin:"",src:"".concat(C.w0).concat(20,"/").concat(t,".svg")},style:{width:20,height:20}})}},{key:"name",name:"Name",minWidth:0,isRowHeader:!0,onRender:function(e){return(0,o.jsx)("span",{className:N.name,"data-selection-invoke":!0,children:e.name})}},{key:"permission",name:"Permission",minWidth:0,isCollapsible:!0,onRender:function(e){return"".concat((e.mode>>6&4).toString(8)).concat((e.mode>>3&4).toString(8)).concat((4&e.mode).toString(8))}},{key:"size",name:"Size",minWidth:0,isCollapsible:!0,onRender:function(e){return e.type===P.LinuxFileType.File?(0,M.BU)(e.size):""}},{key:"mtime",name:"Last Modified Time",minWidth:150,isCollapsible:!0,onRender:function(e){return new Date(1e3*e.mtime).toLocaleString()}}],t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,u=this;s.onColumnClick=function(e,t){if(u.sortKey===t.key){var n=u;(0,T.z)((function(){return n.sortDescending=!n.sortDescending}))}else{var r=u;(0,T.z)((function(){r.sortKey=t.key,r.sortDescending=!1}))}},s.key===this.sortKey&&(s.isSorted=!0,s.isSortedDescending=this.sortDescending)}}catch(l){n=!0,r=l}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return e}},{key:"changeDirectory",value:function(e){this.path!==e&&(this.path=e,U.n.device&&this.loadFiles())}}])&&G(t.prototype,n),r&&G(t,r),e}(),q=new J,Q=(0,D.Pi)((function(){return(0,o.jsx)(u.V,{hidden:!q.uploading,dialogContentProps:{title:"Uploading...",subText:q.uploadPath},children:(0,o.jsx)(l.Y,{description:(0,M.CY)(q.debouncedUploadedSize,q.uploadTotalSize,q.uploadSpeed),percentComplete:q.uploadedSize/q.uploadTotalSize})})}));t.default=(0,D.Pi)((function(){(0,R.useEffect)((function(){return(0,T.z)((function(){q.visible=!0})),function(){(0,T.z)((function(){q.visible=!1}))}}));var e=(0,L.useRouter)();(0,R.useEffect)((function(){var t=e.query.path;t?(Array.isArray(t)&&(t=t[0]),q.changeDirectory(t)):e.replace({query:re({},e.query,{path:q.path})})}),[e]);var t=(0,R.useState)(),n=t[0],r=t[1],i=(0,R.useCallback)(function(){var e=V(a().mark((function e(t){var n,i,o,s,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.n.device.sync();case 2:return n=e.sent,e.prev=3,i=n.read(t),o=new Response(i),e.next=8,o.blob();case 8:s=e.sent,c=window.URL.createObjectURL(s),r(c);case 11:return e.prev=11,n.dispose(),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[3,,11,14]])})));return function(t){return e.apply(this,arguments)}}(),[]),s=(0,R.useCallback)((function(){r(void 0)}),[]),c=(0,R.useCallback)((function(e){switch(e.type){case P.LinuxFileType.Link:case P.LinuxFileType.Directory:q.pushPathQuery(E().resolve(q.path,e.name));break;case P.LinuxFileType.File:switch(E().extname(e.name)){case".jpg":case".png":case".svg":case".gif":i(E().resolve(q.path,e.name))}}}),[i]),u=(0,j.B)((function(){return new p.Y({onSelectionChanged:function(){var e=u.getSelection();(0,T.z)((function(){q.selectedItems=e}))}})})),l=(0,R.useCallback)((function(e,t,n){return!!n&&(q.menuItems.length&&(0,T.z)((function(){q.contextMenuTarget=n})),!1)}),[]),S=(0,R.useCallback)((function(){(0,T.z)((function(){return q.contextMenuTarget=void 0}))}),[]);return(0,o.jsxs)(d.K,re({},M.LE,{children:[(0,o.jsx)(F.default,{children:(0,o.jsx)("title",{children:"File Manager - WebADB"})}),(0,o.jsx)(_.X3,{items:q.menuItems}),(0,o.jsxs)(f.v,{grow:!0,styles:{root:{margin:"-8px -16px -16px -16px",padding:"8px 16px 16px 16px",minHeight:0}},children:[(0,o.jsxs)(h.x,{selection:u,children:[(0,o.jsx)(m.a,{items:q.breadcrumbItems}),(0,o.jsx)(y.J,{items:q.sortedList,columns:q.columns,setKey:q.path,selection:u,layoutMode:v.Oh.justified,enableShimmer:q.loading&&0===q.items.length,onItemInvoked:c,onItemContextMenu:l,onRenderDetailsHeader:B,usePageCache:!0,useReducedRowRenderer:!0})]}),n&&(0,o.jsx)(b.m,{children:(0,o.jsx)(x.a,{onClick:s,children:(0,o.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsx)("img",{src:n,alt:"",style:{maxWidth:"100%",maxHeight:"100%"}})})})}),(0,o.jsx)(_.ag,{children:(0,o.jsx)(g.r,{items:q.menuItems,hidden:!q.contextMenuTarget,directionalHint:k.b.bottomLeftEdge,target:q.contextMenuTarget,onDismiss:S,contextualMenuItemAs:function(e){return(0,o.jsx)(w.W,re({},e,{hasIcons:!1}))}})}),(0,o.jsx)(Q,{})]})]}))})),r()}catch(Y){r(Y)}}),1)}}]);
//# sourceMappingURL=565-cbe227f00a420191.js.map